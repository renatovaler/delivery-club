#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Verificando cÃ³digo..."

# Verifica se hÃ¡ arquivos staged
if git diff --cached --quiet; then
  echo "âŒ Nenhum arquivo para commit"
  exit 1
fi

# Frontend checks
if [ -d "new-frontend" ]; then
  cd new-frontend
  echo "ğŸ“ Verificando tipos do frontend..."
  npm run type-check || exit 1
  
  echo "ğŸ¨ Formatando cÃ³digo do frontend..."
  npm run format || exit 1
  
  echo "ğŸ” Executando lint do frontend..."
  npm run lint || exit 1
  
  cd ..
fi

# Backend checks
if [ -d "backend" ]; then
  cd backend
  echo "ğŸ“ Verificando tipos do backend..."
  npm run type-check || exit 1
  
  echo "ğŸ¨ Formatando cÃ³digo do backend..."
  npm run format || exit 1
  
  echo "ğŸ” Executando lint do backend..."
  npm run lint || exit 1
  
  cd ..
fi

# Verifica mensagem do commit
echo "âœï¸ Verificando mensagem do commit..."
npx --no -- commitlint --edit "$1" || exit 1

echo "âœ… CÃ³digo verificado com sucesso!"
